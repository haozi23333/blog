<template>
  <div>
    <h1>ç»™ ghost å›¾ç‰‡æœåŠ¡åŠ ä¸Š CDN</h1>
    <div id="ember1592">
      <p>æ³¨æ„: åªæ˜¯å›¾ç‰‡æœåŠ¡. ğŸŒ°(æ —å­)æ˜¯ä¸ƒç‰›äº‘çš„  ã€</p>

      <ul>
        <li>å›¾ç‰‡CDN </li>
        <li>å›¾ç‰‡CDNå‚æ•°å‹ç¼© <img src="https://img.shields.io/npm/v/node-coolq.svg" alt=""><br>
          å¯ä»¥å‚è€ƒæˆ‘çš„
          <a href="https://github.com/haozi23333/ghost/commit/e71c9dc23592ba2d11523968b59b82a73d90cb01">commit</a>
        </li>
        <li>
          4444
          <ul>
            <li>
              23333
            </li>
          </ul>
        </li>
      </ul>
      <hr>

      <h2 id="233">æ•ˆæœ</h2>

      <p><a href="https://cdn.hao-zi.com/content/images/2017/04/62463049_p0-2.jpg?imageView2/0/q/75|imageslim">æµ‹è¯•å›¾ç‰‡</a> <br>
        æˆ‘çš„åŸå›¾æ˜¯ 859KB <br>
        ä½¿ç”¨ä¸ƒç‰›å‹ç¼©å‚æ•°</p>

      <pre><code>imageView2/1/w/800/h/600/interlace/1/q/100|watermark/2/text/QGhhb3pp/font/Y29uc29sYXM=/fontsize/500/fill/I0E3QTdBNw==/dissolve/100/gravity/SouthEast/dx/10/dy/10|imageslim
</code></pre>

      <p>å›¾ç‰‡æŒ‡å®š800*600çš„åŒºåŸŸä¸­å¿ƒå‰ªè£ï¼ŒåŠ ä¸Š@haoziçš„æ°´å°å‹ç¼©å›¾ç‰‡ï¼Œå›¾ç‰‡è´¨é‡100% <br>
        è¿™ä¸ªç¼©ç•¥å›¾æ˜¯ç”¨åœ¨æ­£æ–‡å½“ä¸­çš„ <br>
        : 60.7KB
        å‚æ•°

      </p>

      <pre><code>imageView2/0/q/75|imageslim
</code></pre>

      <p>ä¸å‰ªè£ï¼Œ75%çš„è´¨é‡ï¼Œåšå›¾ç‰‡å‹ç¼©: 155kb
        è¿™ä¸ªæ˜¯ç”¨åœ¨æ­£æ–‡å›¾ç‰‡è¢«ç‚¹å‡»æ”¾å¤§çš„æ—¶å€™åŠ è½½çš„ <br>
        å‹ç¼©æ•ˆæœè¿˜æ˜¯ä¸é”™çš„ã€‚å¤§å›¾ç‰‡æˆ‘è¿™è¾¹è®¿é—®è¿˜æ˜¯æ¯”è¾ƒæ…¢çš„ï¼Œå°¤å…¶æ˜¯åšäº†å¤„ç†çš„</p>

      <h2 id="">å®è·µ</h2>

      <h3 id="configjs">config.js</h3>

      <p>æˆ‘ä»¬å…ˆåœ¨config.jsä¸­åŠ ä¸Šæˆ‘ä»¬éœ€è¦çš„é…ç½®</p>

      <pre><code>   production: {
        url: 'http://my-ghost-blog.com',
        mail: {},
        database: {
            client: 'sqlite3',
            connection: {
                filename: path.join(__dirname, '/content/data/ghost.db')
            },
            debug: false
        },

        server: {
            host: '127.0.0.1',
            port: '2368'
        },
        cdn: {
            url: 'https://cdn.hao-zi.com',
            defaultImageParam: '?imageView2/0/q/100|imageslim',
            imageParam: '?imageView2/1/w/800/h/600/interlace/1/q/100|watermark/2/text/QGhhb3pp/font/Y29uc29sYXM=/fontsize/500/fill/I0E3QTdBNw%3d%3d/dissolve/100/gravity/SouthEast/dx/10/dy/10|imageslim'
        }
    },
</code></pre>

      <img src="../assets/emoticon/bigPic.jpg" big alt="">

      <p>åœ¨è¿™æ³¨æ„ä¸€ä¸‹<code>==</code>ä¼šè¢«è§£ææˆ<code>&lt;mark&gt;</code>æ‰€ä»¥è¦è½¬ä¹‰<code>%3d%3d</code></p>

      <h3 id="localfilestorejs">local-file.store.js</h3>

      <p>æ‰¾åˆ°<code>core/server/storage/local-file-store.js</code>
        åœ¨ç¬¬42è¡Œ è¿”å›äº†ä¸€ä¸ªç›¸å¯¹äºæˆ‘ä»¬åŸŸåçš„ä¸€ä¸ªèµ„æºåœ°å€(/content/images/xxx.png)ã€‚æˆ‘ä»¬åœ¨è¿™ä¸ªè·¯å¾„å‰é¢åŠ ä¸Šcdnçš„åœ°å€ï¼Œåé¢åŠ ä¸Šé»˜è®¤çš„å›¾ç‰‡å¤„ç†å‚æ•°ã€‚ <br>
        åœ¨è¿™ä¸ªåœ°æ–¹ä¿®æ”¹äº†ä¹‹åï¼Œæ–°ä¸Šä¼ çš„å›¾ç‰‡éƒ½ä¼šè¢«è½¬æ¢æˆå¸¦cdnå’Œå¤„ç†å‚æ•°çš„åœ°å€ã€‚(æ—§çš„å›¾ç‰‡éœ€è¦é‡æ–°ä¸Šä¼ )</p>

      <pre><code>return config.cdn.url + fullUrl + config.cdn.defaultImageParam;
</code></pre>

      <h3 id="markdown">markdown</h3>

      <p>ghostBlog ä½¿ç”¨çš„æ˜¯ <a href="https://github.com/bsansouci/showdown-ghost">showdown-ghost</a> æ¥è§£æmarkdownè¯­æ³•çš„ã€‚åœ¨æ–‡æ¡£ä¸­æœ‰ä»‹ç»å¦‚ä½•å»ç¼–å†™æ‰©å±•ã€‚ <br>
        æˆ‘ä»è¿™ä¸ªæ’ä»¶<code>/src/extensions/ghostgfm.js</code>ä¸­æ‰¾åˆ°äº†ç”¨æ¥åŒ¹é…å‡º<code>![]</code>è¯­æ³•çš„<a href="https://github.com/bsansouci/showdown-ghost/blob/master/src/extensions/ghostgfm.js#L38">æ­£åˆ™è¡¨è¾¾å¼</a><del>ä¸ä¼šå†™QAQ</del> <br>
        åœ¨<code>/core/server/models</code>ä¸‹é¢æ–°å»ºä¸€ä¸ªæ–‡ä»¶'cdnImage.js'å¯¼å‡ºä¸€ä¸ªå‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ•°ç»„. <br>
        <code>type: lang</code>çš„æ„æ€è¯­è¨€æ‰©å±•(æ‰©å±•è¯­æ³•) <br>
        <code>filter</code>å°±æ˜¯è¿‡æ»¤å™¨ï¼Œä¼ å…¥æ•´ä¸ªmarkdownæ–‡æœ¬ï¼Œè¿”å›è¢«å¤„ç†å¥½çš„æ–‡æœ¬. <br>
        ä¸‹é¢çš„ä»£ç åŸºæœ¬éƒ½æ˜¯<a href="https://github.com/bsansouci/showdown-ghost/blob/master/src/extensions/ghostgfm.js">ghostgfm.js</a>çš„ä¸œè¥¿,ä¸åšè¿‡å¤šçš„è§£é‡Šã€‚åœ¨imgçš„srcåŠ ä¸Šæˆ‘ä»¬configé‡Œé¢çš„cdn.imageParam</p>

      <pre><code>var config = require('../config')
module.exports = function () {
    return [
        {
            type: 'lang',
            filter: function (text) {
                imageMarkdownRegex = /^(?:\{(.*?)\})?!(?:\[([^\n\]]*)\])(?:\(([^\n\]]*)\))?$/gim
                return text.replace(imageMarkdownRegex, function (match, key, alt, src) {
                    if (src) {
                        if (src.indexOf(".pdf") === src.length-4){
                            return '&lt;object data="' + src + '" type="application/pdf" width="100%" height="100%"&gt;' + alt + '&lt;/object&gt;';
                        }

                        return '&lt;img src="' + src.replace(/\?.*/, "") + config.cdn.imageParam + '" alt="' + alt + '" /&gt;';
                    }
                    return '';
                });
            }
        }
    ]
}
</code></pre>

      <p>æ‰¾åˆ°<code>/core/content/models/post.js</code>åœ¨Showdownçš„æ‰©å±•ä¸ŠåŠ ä¸Šæˆ‘ä»¬åˆšåˆšç¼–å†™çš„æ‰©å±•<code>require('./cdnImage')</code>ã€‚è¿™æ ·æˆ‘ä»¬çš„æ‰©å±•ä¼šè¢«ä¼˜å…ˆå¤„ç†. <br>
        é‡å¯ghostçœ‹çœ‹æœ‰æ²¡æœ‰æˆåŠŸ.</p>

      <h2 id="">åè®°</h2>

      <p>è“ç˜¦ï¼Œghostéƒ½æ²¡æœ‰æ’ä»¶æœºåˆ¶ï¼ŒåŠ åŠŸèƒ½è¿˜è¦æ”¹æºç ~~</p>

      <blockquote>
        <p>æœ‰ä»€ä¹ˆé—®é¢˜çš„è¯è¯·åœ¨ä¸‹é¢çš„è¯„è®ºåŒºå‘Šè¯‰æˆ‘QAQ(è¯„è®ºéœ€è¦ç¿»å¢™)</p>
      </blockquote>

      <!----></div>
  </div>
</template>
<script>
  import Vue from 'vue'
  import Component from 'vue-class-component'
  import Icon from 'vue-awesome/components/Icon.vue'
  import 'vue-awesome/icons/user'
  import 'vue-awesome/icons/clock-o'
  import 'vue-awesome/icons/tags'

  @Component({
    props: {

    },
    components: {
      Icon
    }
  })
  export default class Markdown extends Vue {
  }
</script>
<style scoped lang="sass" rel="stylesheet/sass" media="all">
  @import "../assets/css/global"
  @import "../assets/css/markdown"



</style>
